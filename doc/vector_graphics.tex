% VECTOR_GRAPHICS.TEX
%
% The documentation in this file is part of PyXPlot
% <http://www.pyxplot.org.uk>
%
% Copyright (C) 2006-2010 Dominic Ford <coders@pyxplot.org.uk>
%               2009-2010 Ross Church
%
% $Id$
%
% PyXPlot is free software; you can redistribute it and/or modify it under the
% terms of the GNU General Public License as published by the Free Software
% Foundation; either version 2 of the License, or (at your option) any later
% version.
%
% You should have received a copy of the GNU General Public License along with
% PyXPlot; if not, write to the Free Software Foundation, Inc., 51 Franklin
% Street, Fifth Floor, Boston, MA  02110-1301, USA

% ----------------------------------------------------------------------------

% LaTeX source for the PyXPlot Users' Guide

\chapter{Producing Vector Graphics}
\label{ch:vector_graphics}

In previous chapters, we have seen how the \indcmdt{plot} may be used to
produce graphs of functions and \datafile s. We have also seen how the
\indcmdt{set terminal} can be used to produce a wide range of different
graphical formats (see Section~\ref{sec:set_terminal}) and the \indcmdt{set
papersize} can be used to produce postscript output to fit on different sizes
of paper (see Section~\ref{sec:set_papersize}).

In this chapter, we discuss how to produce more sophisticated vector graphics,
beginning with the placement of many graphs side-by-side on a single page of
output, and then moving on to survey the other vector graphics objects which
PyXPlot can produce.

\section{Producing Galleries of Plots}
\label{sec:multiplot}
\index{multiplot}

PyXPlot has two modes in which it can produce vector graphics. In {\it
singleplot} mode, the default, each time the {\tt plot} command is issued, the
canvas is wiped clean and the new plot is placed alone on a blank page. In {\it
multiplot} mode, vector graphics objects accumulate on the canvas. Each time
the {\tt plot} command is issued, the new graph is placed on top of any other
objects which were already on the canvas.

The user can switch between these two modes by entering the commands
\indcmdts{set multiplot} and \indcmdts{set nomultiplot}.  In order for
multiplot mode to become truly useful, one further command is needed at this
point: the \indcmdt{set origin}.  This sets the position on the page of the
lower-left corner of plot produced by the \indcmdt{plot}; it takes a
comma-separated $(x,y)$ co-ordinate pair, which may have units of length, or,
if dimensionless, are assumed to be measured in centimetres. The following
example plots a graph of $\sin(x)$ to the left of a plot of $\cos(x)$:
\begin{verbatim}
set multiplot
plot sin(x)
set origin 10,0
plot cos(x)
\end{verbatim}

\section{Commands for Manipulating Multiplot Canvases}

All objects on a multiplot canvas have their own unique identification number.
By default, these count up from one, such that the first item placed on the
canvas is number one, the next is number two, and so forth. Alternatively, the
user may specify a particular number for a particular object:
\begin{verbatim}
set multiplot
plot item 6 sin(x)
\end{verbatim}
If there were already an object on the canvas with identification number~6,
this object would be deleted and replaced with the new object.

A list of all of the objects on the current multiplot canvas can be obtained
using the \indcmdt{list}. For example, after entering the example in the
previous section, the \indcmdt{list} would output:
\begin{verbatim}
# ID   Command
    1  plot item 1 sin(x)
    2  plot item 2 cos(x)
\end{verbatim}

A multiplot canvas can be wiped clean by issuing the \indcmdt{clear}, which
removes all items currently on the canvas. Alternatively, individual items may
be removed using the \indcmdt{delete}, which should be followed by a
comma-separated list of the identification numbers of the objects to be
deleted. For example, entering {\tt delete 2} after the example above, followed
by the \indcmdt{list} would output:
\begin{verbatim}
# ID   Command
    1  plot item 1 sin(x)
    2  [deleted] plot item 2 cos(x)
\end{verbatim}
Deleted items may be restored using the \indcmdt{undelete}, which likewise
takes a comma-separated list of the identification numbers of the objects to be
restored, e.g.:
\begin{verbatim}
undelete 2
\end{verbatim}
Once a canvas has been cleared using the \indcmdt{clear}, there is no way to
restore it.

Objects may be moved around on the canvas using the \indcmdt{move}. For
example, the following would move item 23 to position $(8,8)$ measured in
inches:
\begin{verbatim}
move 23 to 8*unit(in), 8*unit(in)
\end{verbatim}

ADD SHOW COMMAND HERE.

\section{The {\tt replot} Command Revisited}

In multiplot mode, the \indcmdt{replot} can be used to modify the last plot
added to the page. For example, the following would change the title of the
latest plot to `foo', and add a plot of $\cos(x)$ to it:

\begin{verbatim}
set title 'foo'
replot cos(x)
\end{verbatim}

Additionally, it is possible to modify any plot on the page, by first selecting
it with the \indcmdt{edit}. Subsequently, the \indcmdt{replot} will act upon
the selected plot. The following example would produce two plots, and then
change the colour of the text on the first:

\begin{verbatim}
set multiplot
plot sin(x)
set origin 10,0
plot cos(x)
edit 0        # Select the first plot ...
set textcolour red
replot        # ... and replot it.
\end{verbatim}

The \indcmdt{edit} can also be used to view the settings which are applied to
any plot on the multiplot page -- after executing {\tt edit~0}, the
\indcmdt{show} will show the settings applied to plot zero.

When a new plot is added to the page, the \indcmdt{replot} always switches to
act upon this most recent plot.

\section{Linked Axes}

The axes of plots can be linked together, in such a way that they always share
a common scale. This can be useful when placing plots next to one another,
firstly, of course, if it is of intrinsic interest to ensure that they are on a
common scale, but also because the two plots then do not both need their own
axis labels, and space can be saved by one sharing the labels from the other.
In PyXPlot, an axis which borrows its scale and labels from another is called a
{\it linked axis}.

Such axes are declared by setting the label of the linked axis to a magic
string such as {\tt linkaxis 0}\label{sec:linked_axes}\index{axes!reserved
labels}\index{magic axis labels}. This magic label would set the axis to borrow
its scale from an axis from plot zero. The general syntax is `{\tt linkaxis}
$n$ $m$', where $n$ and $m$ are two integers, separated by a comma or
whitespace. The first, $n$, indicates the plot from which to borrow an axis;
the second, $m$, indicates whether to borrow the scale of axis $x1$, $x2$,
$x3$, etc. By default, $m=1$. The linking will fail, and a warning result, if
an attempt is made to link to an axis which doesn't exist.

\section{Adding Other Vector Graphics Objects}

In addition to graphs, a range of other objects can be placed on multiplot
canvases:
\begin{itemize}
\item Arcs of circles (the \indcmdt{arc}).
\item Arrows (the \indcmdt{arrow}).
\item Rectangular boxes (the \indcmdt{box}).
\item Circles (the \indcmdt{circle}).
\item Ellipses (the \indcmdt{ellipse}).
\item Encapsulated postscript images (the \indcmdt{eps}).
\item Graphical images in {\tt bmp}, {\tt gif}, {\tt jpeg} or {\tt png} formats (the \indcmdt{image}).
\item Lines (the \indcmdt{line}).
\item Points labelled by crosses and other symbols (the \indcmdt{point}).
\item Text labels (the \indcmdt{text}).
\end{itemize}
Put together, these commands can be used to produce a wide range of vector
graphics. In the remainder of this chapter, we describe these commands in turn,
providing a variety of examples of their use.

\subsection{The {\tt text} Command}

Text labels may be added to multiplot canvases using the \indcmdt{text}. This
has the following syntax:

\begin{verbatim}
text 'This is some text' at x,y
\end{verbatim}

In this case, the string `This is some text' would be rendered at position
$(x,y)$ on the multiplot. As with the \indcmdt{set label}, a colour may
optionally be specified with the {\tt with colour} modifier, as well as a
rotation angle to rotate text labels through any given angle, measured in
degrees counter-clockwise. For example:\indkey{rotate}

\begin{verbatim}
text 'This is some text' at x,y rotate r with colour red
\end{verbatim}

The commands \indcmdts{set textcolour}, \indcmdts{set texthalign} and
\indcmdts{set textvalign} can be used to set the colour and alignment of the
text produced with the \indcmdt{text}. Alternatively, the \indcmdt{text} takes
three modifiers to control the alignment of the text which override these {\tt
set} commands. The {\tt halign} and {\tt valign} modifiers may be followed by
any of the settings which may follow the {\tt set texthalign} and {\tt set
textvalign} commands respectively, as in the following examples:

\begin{verbatim}
text 'This is some text' at 0,0 halign left valign top
text 'This is some text' at 0,0 halign right valign centre
\end{verbatim}

\noindent The {\tt gap} modifier allows a gap to be inserted in the alignment
of the text. For example, the string {\tt halign left gap 3*unit(mm)} would
cause text to be rendered with its left side $3\,\mathrm{mm}$ to the right of
the position specified for the text. This is useful for labelling points on
diagrams, where the labels should be slightly offset from the points that they
are associated with. If the {\tt gap} modifier is followed by a dimensionless
number, rather than one with dimensions of lengths, then it is assumed to be
measured in centimetres.

It should be noted that the \indcmdt{text} can also be used outside of the
multiplot environment, to render a single piece of short text instead of a
graph. One obvious application is to produce equations rendered as graphical
files which can subsequently be imported into documents, slideshows or
webpages.\index{presentations}

\subsection{The {\tt arrow} and {\tt line} Commands}

Arrows may also be added to multiplot canvases using the \indcmdt{arrow}, which
has syntax:

\begin{verbatim}
arrow from x,y to x,y
\end{verbatim}

The \indcmdt{arrow} may be followed by the \indmodt{with} keyword to specify to
style of the arrow. The line type, line width and colour of the arrow, may be
specified using the same syntax as used in the plot command, using the {\tt
linetype}, {\tt linewidth} and {\tt colour} modifiers after the word {\tt
with}, as in the example:

\begin{verbatim}
arrow from 0,0 to 10,10 \
with linetype 2 linewidth 5 colour red
\end{verbatim}

\noindent The style of the arrow may also be specified after the word {\tt
with}, and three options are available: {\tt head} (the default), {\tt nohead},
which produces line segments with no arrowheads on them, and {\tt twoway},
which produced arrows with heads on both ends.

The \indcmdt{arrow} has a twin, the \indcmdt{line}, which has the same syntax
but with a different style setting of {\tt nohead}.

\example{ex:notice}{A simple notice with text and arrow}{
In this example script, we use PyXPlot's {\tt arrow} and {\tt text} commands to
produce a simple notice advertising that a lecture has moved to a different
seminar room:
\nlscf
\noindent {\tt \# Turn on multiplot mode }\newline
\noindent {\tt set multiplot ; set nodisplay }\newline
\\
\noindent {\tt \# Set the dimensions of the notice }\newline
\noindent {\tt w = 20~~~~~~~~\# Width of notice / cm }\newline
\noindent {\tt h = w/sqrt(2)~\# Height of notice / cm }\newline
\\
\noindent {\tt \# Put a rectangular box around the notice }\newline
\noindent {\tt line from 0,0 to w,0 with linewidth 5 }\newline
\noindent {\tt line from w,0 to w,h with linewidth 5 }\newline
\noindent {\tt line from w,h to 0,h with linewidth 5 }\newline
\noindent {\tt line from 0,h to 0,0 with linewidth 5 }\newline
\\
\noindent {\tt \# Write the text of the notice in big letters }\newline
\noindent {\tt set texthalign centre ; set fontsize 3 }\newline
\noindent {\tt text "$\backslash$bf Astrophysical Fluids Lecture" at w/2,3/4*h }\newline
\noindent {\tt text "$\backslash$bf MOVED to Seminar Room 3" at w/2, h/2 }\newline
\noindent {\tt arrow from w/4, h/4 to 3/4*w, h/4 with linewidth 8 }\newline
\\
\noindent {\tt \# Display the notice }\newline
\noindent {\tt set display ; refresh }\newline
\nlfcf
The resulting notice is shown below:
\nlscf
\centerline{\includegraphics[width=\textwidth]{examples/eps/ex_notice.eps}}
}

\example{ex:euclid}{Reproducing a diagram from Euclid's {\it Elements}}{
In this more extended example script, we use PyXPlot's {\tt arrow} and {\tt
text} commands to produce a diagram illustrating the 47th Proposition from
Euclid's First Book of {\it Elements}, better known as Pythagoras' Theorem. A
full text of the proof which accompanies this diagram can be found at
\url{http://www.gutenberg.org/etext/21076}.
\nlscf
{\footnotesize
\noindent {\tt set multiplot ; set nodisplay}\newline
}\\{\footnotesize
\noindent {\tt \# Lengths of three sides of triangle}\newline
\noindent {\tt AB = 2*unit(cm)}\newline
\noindent {\tt AC = 4*unit(cm)}\newline
\noindent {\tt BC = hypot(AC, AB) \# Hypotenuse}\newline
\noindent {\tt CBA = atan2(AC, AB) \# Angle CBA}\newline
}\\{\footnotesize
\noindent {\tt \# Positions of three corners of triangle}\newline
\noindent {\tt Bx = 0*unit(cm)~~~~~~~; By = 0*unit(cm) \# The origin}\newline
\noindent {\tt Cx = Bx + BC~~~~~~~~~~; Cy = By}\newline
\noindent {\tt Ax = Bx + AB*cos(CBA) ; Ay = By + AB*sin(CBA)}\newline
}\\{\footnotesize
\noindent {\tt \# Positions of constructed points}\newline
\noindent {\tt Dx = Bx~~~~~~~~~~~~~~~; Dy = -BC}\newline
\noindent {\tt Lx = Ax~~~~~~~~~~~~~~~; Ly = Dy}\newline
\noindent {\tt Ex = Cx~~~~~~~~~~~~~~~; Ey = Dy}\newline
}\\{\footnotesize
\noindent {\tt Hx = Bx + (AB + AC) * cos(CBA)}\newline
\noindent {\tt Hy = By + (AB + AC) * sin(CBA)}\newline
\noindent {\tt Kx = Cx + (~~~~~AC) * cos(CBA)}\newline
\noindent {\tt Ky = Cy + (~~~~~AC) * sin(CBA)}\newline
}\\{\footnotesize
\noindent {\tt Fx = Bx + AB*cos(CBA+90*unit(deg))}\newline
\noindent {\tt Fy = By + AB*sin(CBA+90*unit(deg))}\newline
\noindent {\tt Gx = Ax + AB*cos(CBA+90*unit(deg))}\newline
\noindent {\tt Gy = Ay + AB*sin(CBA+90*unit(deg))}\newline
}\\{\footnotesize
\noindent {\tt \# Construct diagram}\newline
\noindent {\tt box from Dx,Dy to Cx,Cy with fillcol grey80}\newline
\noindent {\tt box at Ax,Ay width AC height AC rot CBA-90*unit(deg) with fillcol grey80}\newline
\noindent {\tt box at Bx,By width AB height AB rot CBA with fillcol grey80}\newline
\noindent {\tt line from Bx,By to Kx,Ky}\newline
\noindent {\tt line from Fx,Fy to Cx,Cy}\newline
\noindent {\tt line from Ax,Ay to Dx,Dy}\newline
\noindent {\tt line from Ax,Ay to Lx,Ly}\newline
\noindent {\tt line from Ax,Ay to Ex,Ey}\newline
}\\{\footnotesize
\noindent {\tt \# Label diagram}\newline
\noindent {\tt set fontsize 1.3}\newline
\noindent {\tt TG = 0.5*unit(mm) \# Gap left between labels and figure}\newline
\noindent {\tt text "A" at Ax,Ay gap TG*5 hal c val b}\newline
\noindent {\tt text "B" at Bx,By gap TG~~~hal r val t}\newline
\noindent {\tt text "C" at Cx,Cy gap TG~~~hal l val t}\newline
\noindent {\tt text "D" at Dx,Dy gap TG~~~hal c val t}\newline
\noindent {\tt text "E" at Ex,Ey gap TG~~~hal c val t}\newline
\noindent {\tt text "F" at Fx,Fy gap TG~~~hal r val c}\newline
\noindent {\tt text "G" at Gx,Gy gap TG~~~hal c val b}\newline
\noindent {\tt text "H" at Hx,Hy gap TG~~~hal c val b}\newline
\noindent {\tt text "K" at Kx,Ky gap TG~~~hal l val c}\newline
\noindent {\tt text "L" at Lx,Ly gap TG~~~hal c val t}\newline
}\\{\footnotesize
\noindent {\tt \# Display diagram}\newline
\noindent {\tt set display ; refresh}\newline
}
\nlfcf
The resulting diagram is shown below:
\nlscf
\centerline{\includegraphics[width=8cm]{examples/eps/ex_euclid_I_47.eps}}
}

\subsection{The {\tt image} Command}

Graphical images in {\tt bmp}, {\tt gif}, {\tt jpeg} or {\tt png} format may be
placed on multiplot canvases using the \indcmdt{image}\footnote{To maintain
compatibility with historic versions of PyXPlot, the {\tt image} command may
also be spelt {\tt jpeg}, with the identical syntax thereafter.}. This has
syntax:
\begin{verbatim}
image 'filename' at x,y width w
\end{verbatim}

As an alternative to the \indkeyt{width} keyword the height of the image can be
specified, using the analogous \indkeyt{height} keyword.  An optional angle can
also be specified using the \indkeyt{rotate} keyword; this causes the included
image to be rotated counter-clockwise by a specified angle, measured in
degrees.

\subsection{The {\tt eps} Command}

Vector graphic images in eps format may be placed on multiplot canvases
using the \indcmdt{eps}, which has a syntax analogous to the {\tt image}
command.  However neither height nor width need be specified; in this case the
image will be included at its native size.  For example:

\begin{verbatim}
eps 'filename' at 3,2 rotate 5
\end{verbatim}

\noindent will place the eps file with its bottom-left corner at position
$(3,2)$\,cm from the origin, rotated counter-clockwise through 5 degrees.

\subsection{The {\tt box} and {\tt circle} Commands}
\label{sec:rectangle}

Rectangular boxes and circles may be placed on multiplot canvases
using the {\tt box} and {\tt circle} commands\indcmd{box}\indcmd{circle}, as
in:

\begin{verbatim}
box from 0*unit(mm),0*unit(mm) to 25*unit(mm),70*unit(mm)
circle at 0*unit(mm),0*unit(mm) radius 70*unit(mm)
\end{verbatim}

\noindent In the former case, two corners of the rectangle are specified,
meanwhile in the latter case the centre of the circle and its radius are
specified. The \indcmdt{box} may also be invoked by the synonym {\tt
rectangle}\indcmd{rectangle}. Boxes may be rotated using an optional {\tt
rotate} modifier, which may be followed by a counter-clockwise rotational angle
which may either have dimensions of angle, or is assumed to be in degrees if
dimensionless. The rotation is performed about the centre of the rectangle:

\begin{verbatim}
box from 0,0 to 10,3 rotate 45
\end{verbatim}

The positions and dimensions of boxes may also be specified by giving the
position of one of the corners of the box, together with its width and height.
The specified corner is assumed to be the bottom-left corner if both the
specified width and height are positive; other corners may be specified if the
supplied width and/or height are negative. If such boxes are rotated, the
rotation is about the specified corner:

\begin{verbatim}
box at 0,0 width 10 height 3 rotate 45
\end{verbatim}

The line type, line width, and colour of line with which the outlines of boxes
and circles are drawn may be specified as in the {\tt arrow} command, for
example:

\begin{verbatim}
circle at 0,0 radius 5 with linetype 1 linewidth 2 colour red
\end{verbatim}

\noindent The shapes may be filled by specifying a {\tt fillcolour}:

\begin{verbatim}
circle at 0,0 radius 5 with lw 10 colour red fillcolour yellow
\end{verbatim}

\example{ex:noentry}{A simple no-entry sign}{
In this example script, we use PyXPlot's {\tt box} and {\tt circle} commands to
produce a no-entry sign warning passers by that code monkeys can turn nasty
when interrupted from their work.
\nlscf
\noindent {\tt set multiplot ; set nodisplay}\newline
\noindent {\tt }\newline
\noindent {\tt w = 10 \# Width of sign / cm}\newline
\\
\noindent {\tt \# Make no-entry sign}\newline
\noindent {\tt circle at 0,0 radius w with col null fillcol red}\newline
\noindent {\tt box from -(0.8*w),-(0.2*w) to (0.8*w),(0.2*w) $\backslash$}\newline
\noindent {\tt \phantom{xxxx}with col null fillcol white}\newline
\\
\noindent {\tt \# Put a warning beneath the sign}\newline
\noindent {\tt set fontsize 3}\newline
\noindent {\tt set texthalign centre ; set textvalign centre}\newline
\noindent {\tt text "$\backslash$bf Keep Out! Code Monkey at work!"}\newline
\\
\noindent {\tt \# Display sign}\newline
\noindent {\tt set display ; refresh}\newline
\vspace{2mm}\\
\nlfcf
The resulting sign is shown below:
\nlscf
\centerline{\includegraphics[width=5cm]{examples/eps/ex_noentry.eps}}
}

\example{ex:mandelbrot}{Producing an image of the Mandelbrot Set}{
The Mandelbrot set is a set of points in the complex plane, whose boundary
forms a fractal. It is an iconic image of the power of chaos theory to produce
complicated structure out of simple algorithms, which we implement in this
example using PyXPlot's loop constructs.
\nlnp
A point $c$ in the complex plane is defined to lie within the Mandelbrot set if
the complex sequence of numbers
\begin{displaymath}
z_{n+1} = z_n^2 + c,
\end{displaymath}
subject to the starting condition $z_0=0$, remains bounded. In practice, the
sequence is certain to diverge if $|z_n|$ ever exceeds~2.  It cannot generally
be proven not to diverge at any particular point, but is declared to remain
bounded in our algorithm if $|z_n|$ has not exceeded~2 within a certain number
{\tt StepsMax} of steps. To increase the aesthetic appeal of the fractal,
pixels outside of the fractal are assigned different colours depending upon how
many iterations were required before the sequence moved outside the circle
$|z_n|=2$.
\nlnp
This script makes use of the \indcmdt{rectangle} to paint each pixel of the
fractal one by one, which is highly inefficient, but demonstrates PyXPlot's
versatility.
\nlscf
\noindent {\tt set~multiplot }\newline
\noindent {\tt set~nodisplay }\newline
\noindent {\tt set~numerics~complex }\newline
\noindent {\tt StepsMax=10 }\newline
\noindent {\tt yn=0 }\newline
\noindent {\tt for~y=2~to~-2~step~-0.05 }\newline
\noindent {\tt \phantom{x}\{ }\newline
\noindent {\tt \phantom{xx}xn=0 }\newline
\noindent {\tt \phantom{xx}for~x=-2~to~2~step~0.05 }\newline
\noindent {\tt \phantom{xxx}\{ }\newline
\noindent {\tt \phantom{xxxx}zi~=~x+i*y;~z=zi;~iter=0; }\newline
\noindent {\tt \phantom{xxxx}while~(abs(z)<2)~and~(iter<StepsMax)~$\backslash$ }\newline
\noindent {\tt \phantom{xxxxxxxx}\{~;~z~=~z**2~+~zi~;~iter=iter+1~;~\} }\newline
\noindent {\tt \phantom{xxxx}cd~=~(1-iter/StepsMax)*256 }\newline
\noindent {\tt \phantom{xxxx}rectangle~from~xn,yn~to~xn+0.21,yn+0.21~with~col~null~$\backslash$ }\newline
\noindent {\tt \phantom{xxxxxxxxxxx}fillc~rgb(cd):(cd):(cd) }\newline
\noindent {\tt \phantom{xxxx}xn=xn+0.2 }\newline
\noindent {\tt \phantom{xxx}\} }\newline
\noindent {\tt \phantom{xx}yn=yn+0.2 }\newline
\noindent {\tt \phantom{x}\} }\newline
\noindent {\tt }\newline
\noindent {\tt \#~Display~output }\newline
\noindent {\tt set~display }\newline
\noindent {\tt refresh }\newline
\nlscf
The resulting image is shown below:
\nlscf
\begin{center}
\includegraphics[width=8cm]{examples/eps/ex_mandelbrot.eps}
\end{center}
}

\subsection{The {\tt arc} Command}
\label{sec:arc}

Partial arcs of circles may be drawn using \indcmdt{arc}. This has similar
syntax to \indcmdt{circle}, but takes two additional angle, measured clockwise
from the upward vertical direction, which specify the extent of the arc to be
drawn. The arc is drawn clockwise from start to end, and hence the following
two instructions draw two complementary arcs which together form a complete
circle:

\begin{verbatim}
set multiplot
arc at 0,0 radius 5 from -90 to   0 with lw 3 col red
arc at 0,0 radius 5 from   0 to -90 with lw 3 col green
\end{verbatim}

\noindent If a {\tt fillcolour} is specified, then a pie-wedge is drawn:

\begin{verbatim}
arc at 0,0 radius 5 from 0 to 30 with lw 3 fillcolour red
\end{verbatim}

\example{ex:triangle}{A labelled diagram of a triangle}{
In this example, we make a subroutine to draw labelled diagrams of the interior
angles of triangles, taking as its inputs the lengths of the three sides of the
triangle to be drawn and the position of its lower-left corner. The subroutine
calculates the positions of the three vertices of the triangle and then labels
them. We use PyXPlot's automatic handling of physical units to generate the
\LaTeX\ strings required to label the side lengths in centimetres and the
angles in degrees. We use PyXPlot's {\tt arc} command to draw angle symbols in
the three corners of a triangle.
\nlscf
{\footnotesize
\noindent {\tt \# Define subroutine for drawing triangles}\newline
\noindent {\tt subroutine TriangleDraw(Bx,By,AB,AC,BC)}\newline
\noindent {\tt \phantom{x}\{}\newline
\noindent {\tt \phantom{xx}\# Use cosine rule to find interior angles}\newline
\noindent {\tt \phantom{xx}ABC = acos((AB**2 + BC**2 - AC**2) / (2*AB*BC))}\newline
\noindent {\tt \phantom{xx}BCA = acos((BC**2 + AC**2 - AB**2) / (2*BC*AC))}\newline
\noindent {\tt \phantom{xx}CAB = acos((AC**2 + AB**2 - BC**2) / (2*AC*AB))}\newline
}\\{\footnotesize
\noindent {\tt \phantom{xx}\# Positions of three corners of triangle}\newline
\noindent {\tt \phantom{xx}Cx = Bx + BC~~~~~~~~~~; Cy = By}\newline
\noindent {\tt \phantom{xx}Ax = Bx + AB*cos(ABC) ; Ay = By + AB*sin(ABC)}\newline
}\\{\footnotesize
\noindent {\tt \phantom{xx}\# Draw triangle}\newline
\noindent {\tt \phantom{xx}line from Ax,Ay to Bx,By}\newline
\noindent {\tt \phantom{xx}line from Ax,Ay to Cx,Cy}\newline
\noindent {\tt \phantom{xx}line from Bx,By to Cx,Cy}\newline
}\\{\footnotesize
\noindent {\tt \phantom{xx}\# Draw angle symbols}\newline
\noindent {\tt \phantom{xx}ArcRad = 4*unit(mm) \# Radius of angle arcs}\newline
\noindent {\tt \phantom{xx}arc at Bx,By radius ArcRad from~~90*unit(deg)-ABC to~~90*unit(deg)}\newline
\noindent {\tt \phantom{xx}arc at Cx,Cy radius ArcRad from -90*unit(deg)~~~~~to -90*unit(deg)+BCA}\newline
\noindent {\tt \phantom{xx}arc at Ax,Ay radius ArcRad from~~90*unit(deg)+BCA to 270*unit(deg)-ABC}\newline
}\\{\footnotesize
\noindent {\tt \phantom{xx}\# Label lengths of sides}\newline
\noindent {\tt \phantom{xx}set unit of length cm \# Display lengths in cm}\newline
\noindent {\tt \phantom{xx}set numeric sigfig 3 display latex \# Correct to 3 significant figure}\newline
\noindent {\tt \phantom{xx}set fontsize 1.2 \# And in slightly bigger text than normal}\newline
\noindent {\tt \phantom{xx}TextGap = 1*unit(mm)}\newline
\noindent {\tt \phantom{xx}text "\%s"\%(BC) at (Bx+Cx)/2,(By+Cy)/2 gap TextGap hal c val t}\newline
\noindent {\tt \phantom{xx}text "\%s"\%(AB) at (Ax+Bx)/2,(Ay+By)/2 gap TextGap rot  ABC hal c val b}\newline
\noindent {\tt \phantom{xx}text "\%s"\%(AC) at (Ax+Cx)/2,(Ay+Cy)/2 gap TextGap rot -BCA hal c val b}\newline
}\\{\footnotesize
\noindent {\tt \phantom{xx}\# Label angles}\newline
\noindent {\tt \phantom{xx}set unit of angle degree \# Display angles in degrees}\newline
\noindent {\tt \phantom{xx}ArcRad2 = 1.4 * ArcRad \# Distance of text from apex of angles}\newline
\noindent {\tt \phantom{xx}text "\%s"\%(CAB) at Ax+ArcRad2*sin(ABC-BCA),Ay-ArcRad2*cos(ABC-BCA) hal c val t}\newline
\noindent {\tt \phantom{xx}text "\%s"\%(ABC) at Bx+ArcRad2*cos(ABC/2),By+ArcRad2*sin(ABC/2) hal l val c}\newline
\noindent {\tt \phantom{xx}text "\%s"\%(BCA) at Cx-ArcRad2*cos(BCA/2),Cy+ArcRad2*sin(BCA/2) hal r val c}\newline
}\\{\footnotesize
\noindent {\tt \phantom{xx}\# Label points ABC}\newline
\noindent {\tt \phantom{xx}text "A" at Ax,Ay gap TextGap hal c val b}\newline
\noindent {\tt \phantom{xx}text "B" at Bx,By gap TextGap hal r val c}\newline
\noindent {\tt \phantom{xx}text "C" at Cx,Cy gap TextGap hal l val c}\newline
\noindent {\tt \phantom{x}\}}\newline
}\\{\footnotesize
\noindent {\tt \# Display diagram with three triangles}\newline
\noindent {\tt set multiplot ; set nodisplay}\newline
\noindent {\tt call TriangleDraw(2.8*unit(cm),3.4*unit(cm), 3*unit(cm),4*unit(cm),4*unit(cm))}\newline
\noindent {\tt call TriangleDraw(0.0*unit(cm),0.0*unit(cm), 3*unit(cm),4*unit(cm),5*unit(cm))}\newline
\noindent {\tt call TriangleDraw(6.5*unit(cm),0.0*unit(cm), 3*unit(cm),3*unit(cm),3*unit(cm))}\newline
\noindent {\tt set display ; refresh}\newline
}
\nlfcf
The resulting diagram is shown below:
\nlscf
\centerline{\includegraphics{examples/eps/ex_triangle.eps}}
}

\example{ex:lens}{A labelled diagram of a converging lens forming a real image}{
In this example, we make a subroutine to draw labelled diagrams of converging
lenses forming real images.
\nlscf
{\footnotesize
\noindent {\tt subroutine LensDraw(x0,y0,u,h,f)}\newline
\noindent {\tt \phantom{x}\{}\newline
\noindent {\tt \phantom{xx}\# Use the thin-lens equation to find v and H}\newline
\noindent {\tt \phantom{xx}v = 1/(1/f - 1/u)}\newline
\noindent {\tt \phantom{xx}H = h * v / u}\newline
}\\{\footnotesize
\noindent {\tt \phantom{xx}\# Draw lens}\newline
\noindent {\tt \phantom{xx}lc = 5.5*unit(cm) \# Radius of curvature of lens}\newline
\noindent {\tt \phantom{xx}lt = 0.5*unit(cm) \# Thickness of lens}\newline
\noindent {\tt \phantom{xx}la = acos((lc-lt/2)/lc) \# Angular size of lens from centre of curvature}\newline
\noindent {\tt \phantom{xx}lh = lc*sin(la) \# Physical height of lens on paper}\newline
\noindent {\tt \phantom{xx}arc at x0-(lc-lt/2),y0 radius lc from~~90*unit(deg)-la to~~90*unit(deg)+la}\newline
\noindent {\tt \phantom{xx}arc at x0+(lc-lt/2),y0 radius lc from 270*unit(deg)-la to 270*unit(deg)+la}\newline
\noindent {\tt \phantom{xx}set texthalign right ; set textvalign top}\newline
\noindent {\tt \phantom{xx}point at x0-f,y0 label "\$f\$"}\newline
\noindent {\tt \phantom{xx}set texthalign left~~; set textvalign bottom}\newline
\noindent {\tt \phantom{xx}point at x0+f,y0 label "\$f\$"}\newline
}\\{\footnotesize
\noindent {\tt \phantom{xx}\# Draw object and image}\newline
\noindent {\tt \phantom{xx}arrow from x0-u,y0 to x0-u,y0+h with lw 2}\newline
\noindent {\tt \phantom{xx}arrow from x0+v,y0 to x0+v,y0-H with lw 2}\newline
\noindent {\tt \phantom{xx}text "\$h\$" at x0-u,y0+h/2 hal l val c gap unit(mm)}\newline
\noindent {\tt \phantom{xx}text "\$H\$" at x0+v,y0-H/2 hal l val c gap unit(mm)}\newline
}\\{\footnotesize
\noindent {\tt \phantom{xx}\# Draw construction lines}\newline
\noindent {\tt \phantom{xx}line from x0-u,y0 to x0+v,y0 with lt 2 \# Optic axis}\newline
\noindent {\tt \phantom{xx}line from x0-u,y0+h to x0+v,y0-H \# Undeflected ray through origin}\newline
\noindent {\tt \phantom{xx}line from x0-u,y0+h to x0,y0+h}\newline
\noindent {\tt \phantom{xx}line from x0,y0+h to x0+v,y0-H}\newline
\noindent {\tt \phantom{xx}line from x0+v,y0-H to x0,y0-H}\newline
\noindent {\tt \phantom{xx}line from x0,y0-H to x0-u,y0+h}\newline
}\\{\footnotesize
\noindent {\tt \phantom{xx}\# Label distances u and v}\newline
\noindent {\tt \phantom{xx}ylabel = y0-lh-2*unit(mm)}\newline
\noindent {\tt \phantom{xx}arrow from x0-u,ylabel to x0,ylabel with twoway lt 2}\newline
\noindent {\tt \phantom{xx}arrow from x0+v,ylabel to x0,ylabel with twoway lt 2}\newline
\noindent {\tt \phantom{xx}text "\$u\$" at x0-u/2,ylabel hal c val t gap unit(mm)}\newline
\noindent {\tt \phantom{xx}text "\$v\$" at x0+v/2,ylabel hal c val t gap unit(mm)}\newline
\noindent {\tt \phantom{x}\}}\newline
}\\{\footnotesize
\noindent {\tt \# Display diagram of lens}\newline
\noindent {\tt set multiplot ; set nodisplay}\newline
\noindent {\tt call LensDraw(0*unit(cm),0*unit(cm), 5*unit(cm),1.5*unit(cm),2*unit(cm))}\newline
\noindent {\tt set display ; refresh}\newline
}
\nlfcf
The resulting diagram is shown below:
\nlscf
\centerline{\includegraphics{examples/eps/ex_lenses.eps}}
}

\subsection{The {\tt point} Command}
\label{sec:point}

\subsection{The {\tt ellipse} Command}
\label{sec:ellipse}

Ellipses may be placed on multiplot canvases using \indcmdt{ellipse}. The shape
of the ellipse may be specified in many different ways, by specifying

\begin{enumerate}[(i)]
\item the position of two corners of the smallest rectangle which can enclose
the ellipse when its major axis is horizontal, together with an optional
counter-clockwise rotation angle, applied about the centre of the ellipse.
For example:

\begin{verbatim}
ellipse from 0,0 to 4,1 rot 70
\end{verbatim}

\item the position of both the centre and one of the foci of the ellipse,
together with any one of the following pieces of information: the major axis
length, the semi-major axis length, the minor axis length, the semi-minor axis
length, the eccentricity, the latus rectum, or the semi-latus rectum.  For
example:

\begin{verbatim}
ellipse focus 0,0 centre 2,2 majoraxis 4
ellipse focus 0,0 centre 2,2 minoraxis 4
ellipse focus 0,0 centre 2,2 ecc 0.5
ellipse focus 0,0 centre 2,2 LatusRectum 6
ellipse focus 0,0 centre 2,2 slr 3
\end{verbatim}

\item the position of either the centre or one of the foci of the ellipse,
together with any two of the following pieces of information: the major axis
length, the semi-major axis length, the minor axis length, the semi-minor axis
length, the eccentricity, the latus rectum, or the semi-latus rectum. An
optional counter-clockwise rotation angle may also be specified, applied about
either the centre or one of the foci of the ellipse, whichever is specified. If
no rotation angle is given, then the major axis of the ellipse is horizontal.
For example:

\begin{verbatim}
ellipse centre 0,0 majoraxis 4 minoraxis 4
\end{verbatim}
\end{enumerate}

The line type, line width, and colour of line with which the outlines of
ellipses are drawn may be specified as in the {\tt box} and {\tt circle}
commands above. Likewise, ellipses may be filled in the same manner.

\example{ex:ellipse}{A labelled diagram of an ellipse}{
In this example script, we illustrate the text of Section~\ref{sec:ellipse} by
using PyXPlot's {\tt ellipse} command, together with arrows and text labels, to
produce a labelled diagram of an ellipse. We label the semi-major axis $a$, the
semi-minor axis $b$, the semi-latus rectum $L$, and the distance between the
centre of the ellipse and one of its foci with the length $ae$, where $e$ is
the eccentricity of the ellipse.
\nlscf
{\footnotesize
\noindent {\tt set multiplot ; set nodisplay }\newline
\noindent {\tt }\newline
\noindent {\tt a~~~= 6.0~~~~~~~~~~~~~~\# Semi-major axis }\newline
\noindent {\tt b~~~= 4.0~~~~~~~~~~~~~~\# Semi-minor axis }\newline
\noindent {\tt e~~~= sqrt(1-(b/a)**2)~\# Eccentricity }\newline
\noindent {\tt slr~= a*(1-e**2)~~~~~~~\# Length of semi-latus rectum }\newline
\noindent {\tt fd~~= a*e~~~~~~~~~~~~~~\# Distance of focus from centre }\newline
}\\{\footnotesize
\noindent {\tt \# Draw ellipse }\newline
\noindent {\tt ellipse centre 0,0 SemiMajor a SemiMinor b with lw 3 }\newline
\noindent {\tt }\newline
\noindent {\tt \# Draw points at centre and focus}\newline
\noindent {\tt set texthalign centre ; set textvalign top}\newline
\noindent {\tt set fontsize 1.5}\newline
\noindent {\tt point at 0,0 label "Centre" with pointsize 2 plw 2}\newline
\noindent {\tt point at -fd,0 label "Focus" with pointsize 2 plw 2}\newline
}\\{\footnotesize
\noindent {\tt \# Draw arrows and dotted lines on ellipse }\newline
\noindent {\tt arrow from 0,0 to 0,b with twohead lw 2 lt 3~~~\# Semi-minor axis}\newline
\noindent {\tt arrow from 0,0 to a,0 with twohead lw 2 lt 3~~~\# Semi-major axis}\newline
\noindent {\tt arrow from -fd,0 to -fd,slr with tw lw 2 lt 3~~\# SLR}\newline
\noindent {\tt arrow from 0,0 to -fd,0 with twohead lw 2 lt 3 \# Focus $<$-$>$ Centre}\newline
}\\{\footnotesize
\noindent {\tt \# Label ellipse }\newline
\noindent {\tt set texthalign centre ; set textvalign centre}\newline
\noindent {\tt text '\$ae\$' at -fd/2,-0.3}\newline
\noindent {\tt text '\$a\$' at a/2,+0.3}\newline
\noindent {\tt text '\$b\$' at 0.3,b/2}\newline
\noindent {\tt set texthalign left ; set textvalign centre}\newline
\noindent {\tt text '\$L=a(1-e\^{}2)\$' at  0.2-fd,slr/2}\newline
}\\{\footnotesize
\noindent {\tt \# Display diagram }\newline
\noindent {\tt set display ; refresh }\newline
}
\nlfcf
The resulting diagram is shown below:
\nlscf
\centerline{\includegraphics[width=8cm]{examples/eps/ex_ellipse.eps}}
}

\subsection{The {\tt piechart} Command}
\label{sec:piechart}

\example{ex:piechart}{A piechart of the composition of the Universe}{
It is the beginning of many a news story about cosmology. Astronomers tell us
that of the material which makes up the Universe, only 4\% is in the form of
the baryonic matter which we know and love. The rest is composed of dark matter
(22\%) and dark energy (74\%). That is all very well, though, of course, rather
few people were actually aware until a few seconds ago that they were made up
of stuff called baryonic matter at all. And then, of course, comes the next
obvious question, ``So what is dark matter and dark energy?''. And there,
sadly, the story ends.  Dark energy is... well... it's the number in the
equations which makes the cosmology work.
\nlnp
But rest assured. While cosmologists work on the problem, PyXPlot can plot
piecharts of the composition of the Universe:
\nlscf
\noindent{\tt set palette grey40, grey60, grey80}\newline
\noindent{\tt set width 6}\newline
\noindent{\tt piechart '--' using \$1 label key "\%s"\%(\$2)}\newline
\noindent{\tt 0.22 Dark$\sim$Matter}\newline
\noindent{\tt 0.04 Baryonic$\sim$Matter}\newline
\noindent{\tt 0.74 Dark$\sim$Energy}\newline
\noindent{\tt END}
\nlscf
\centerline{\includegraphics{examples/eps/ex_piechart.eps}}
\nlfcf
bar
\nlscf
\centerline{\includegraphics{examples/eps/ex_piechart2.eps}}
}

\subsection{The Construction of Large Multiplots}
\label{sec:set_display}

By default, whenever an item is added to a multiplot, or an existing item moved
or replotted, the whole multiplot is replotted to show the change. This can be
a time consuming process on large and complex multiplots. For this reason, the
\indcmdt{set nodisplay} is provided, which stops PyXPlot from producing any
output. The \indcmdt{set display} can subsequently be issued to return to
normal behaviour.

This can be especially useful in scripts which produce large multiplots. There
is no point in producing output at each step in the construction of a large
multiplot, and a great speed increase can be achieved by wrapping the script
with:

\begin{verbatim}
set nodisplay
[...prepare large multiplot...]
set display
refresh
\end{verbatim}

\subsection{The \indcmdt{refresh}}

\index{replotting} The \indcmdt{refresh} is rather similar to the
\indcmdt{replot}, but produces an exact copy of the latest display. This can be
useful, for example, after changing the terminal type, to produce a second copy
of a multiplot page in a different format. But the crucial difference between
this command and {\tt replot} is that it doesn't replot anything. Indeed, there
could be only textual items and arrows on the present multiplot page, and no
graphs {\it to} replot.

\section{LaTeX and PyXPlot}

The \indcmdt{text} can straightforwardly be used to render simple one-line
\LaTeX\index{latex} strings, but sometimes the need arises to place more
substantial blocks of text onto a plot. For this purpose, it can be useful to
use the \LaTeX\ {\tt parbox} or {\tt minipage} environments\footnote{Remember,
any valid \LaTeX\ string can be passed to the \indcmdt{text} and \indcmdt{set
label}.}. For example:

\begin{verbatim}
text '\parbox[t]{6cm}{\setlength{\parindent}{1cm} \
\noindent There once was a lady from Hyde, \\ \
Who ate a green apple and died, \\ \
\indent While her lover lamented, \\ \
\indent The apple fermented, \\ \
and made cider inside her inside.}'
\end{verbatim}

\begin{center}
\fbox{\includegraphics{examples/eps/ex_text1.eps}}
\end{center}

If unusual mathematical symbols are required, for example those in the {\tt
amsmath} package\index{amsmath package@{\tt amsmath} package}, such a package
can be loaded using the \indcmdt{set preamble}. For example:

\begin{verbatim}
set preamble \usepackage{marvosym}
text "{\Huge\Dontwash\ \NoIroning\ \NoTumbler}$\;$ Do not \
wash, iron or tumble-dry this plot."
\end{verbatim}

\begin{center}
\fbox{\includegraphics{examples/eps/ex_text2.eps}}
\end{center}

